# Запуск

Из каталога проекта:
```shell
python3 content_extractor.py <адрес страницы>
```

Посмотреть список опций:
```shell
python3 content_extractor.py -h
```

# Описание алгоритма

1. Загружаем содержимое страницы.
2. Создаем html-парсер, который выполнит первичную подготовку документа к обходу -
оставит только блок body и отфильтрует void-элементы (https://www.w3.org/TR/2011/WD-html-markup-20110113/syntax.html#void-elements).
Они не нужны для выделения содержательной части.
3. Рассматриваем документ как последовательность параграфов и заголовков. Наша задача 
определить места где они чередуют друг друга, для расстановки отбивки и форматирования.
4. Изначально предполагаем, что мы находимся в начале параграфа, поэтому любой текст 
записываем в вывод как часть параграфа.
5. Во время обхода документа, при посещении открытия тега, каждый элемент может быть отнесен к следующему типу:
- `шум` - элемент содержит не существенную часть (рекламу, видео, скрипт, навигацию и т.д)
- `заголовок` - элемент содержит текст заголовка.
- `параграф` - элемент содержит текст параграфа.  
- `ссылка` - элемент содержит ссылку.  

Для определения типа документа используется набор правил, которые описаны в текстовом файле и загружаются до начала
разбора документа. Правила используют выражения, которые позволяют по имени тега и/или атрибутам элемента отнести его к 
одному из перечисленных выше типов.  

Если элемент относится к типу `шум`, то пропускаем все его вложенные узлы (включая текстовые).  

Если элемент относится к типу `заголовок`, то:  
- если мы до этого находились в узле с типом `параграф`, то вставляем в вывод новую строку и меняем тип текущего элемента;  
- если мы до этого находились в узле с типом `заголовок`, то с выводом ничего не делаем, но увеличиваем счетчик глубины
вложенности заголовка - он понадобится для определения состояния завершения самого внешнего заголовка. Визуально вложенные 
заголовки никак не отображаются - их текст интерпретируется как единый заголовок;

Если элемент относится к типу `параграф`, то:  
- если мы до этого находились в узле с типом `параграф`, то вставляем в вывод новую строку, если предыдущий параграф не 
был пустым. В противном случае ничего не делаем, чтобы избежать лишних пустых строк; 
- если мы до этого находились в узле с типом `заголовок`, то с выводом ничего не делаем. Считаем, что параграф в заголовке - 
это часть заголовка;

Если элемент относится к типу `ссылка`, то добавляем в вывод отформатированное содержимое атрибута `href`.

6. При посещении текстового узла:
- если мы находимся в узле с типом `заголовок`, то вставляем в вывод полученный текст с префиксом `#` для визуального 
выделения заголовков;
- если мы до этого находились в узле с типом `параграф`, то просто добавляем текст в вывод;

7. При посещении закрытия узла:
- если мы до этого находились в узле с типом `заголовок`, то уменьшаем счетчик глубины вложенности заголовков. 
Если счетчик обнулился, то считаем что заголовок завершен и переключаем тип текущего элемента в `параграф`;

8. После обхода, весь собранный текстовый вывод либо сохраняется в файл, либо выводится в стандартный вывод 
(в зависимости от заданных опций)

# Результаты тестирования:

Тестирование проводилось на Linux с Python 3.8.  

https://www.rbc.ru/business/05/07/2023/64a2a9cc9a7947756f50c0c3
```markdown
# Компании предупредили о рисках остановки полетов на «кукурузниках» Ан-2

Авиакомпании столкнулись с риском остановки полетов на самолетах Ан-2 из-за
проблем с поставками импортных запчастей. Но уже в 2024 году для их замены
перевозчики начнут получать новые воздушные суда «Байкал», обещает Минпромторг

Самолёт Ан-2

Российские авиакомпании, эксплуатирующие легкие многоцелевые самолеты Ан-2
(«кукурузники»), столкнулись с дефицитом запчастей из-за отказа европейских
поставщиков сотрудничать с Россией после начала специальной военной операции на
Украине. Эта проблема обсуждалась на заседании рабочей группы «Развитие
авиационных перевозок и региональных аэропортов» комиссии Госсовета по
направлению «Транспорт», которое состоялось 29 июня, рассказали РБК два
участника этого совещания.

По их словам, гендиректор Московского авиационно-ремонтного завода (МАРЗ) Павел
Ненастьев, выступая на этом совещании, указал на проблемы с поставками запчастей
для Ан-2 и их подорожании. Он также заявил о необходимости производства в России
около 60 комплектующих для этих самолетов.

Если не принять меры, у МАРЗ и других ремонтных предприятий «может просто-
напросто прекратиться возможность оказывать сервисные услуги», подтвердил РБК
сам Ненастьев. «Это грозит остановкой парка самолетов Ан-2», — предупредил он. У
Шахтинского авиационно-ремонтном завода (ШАРЗ) аналогичная позиция по
перспективам эксплуатации Ан-2, добавил его гендиректор Владимир Соломатов. По
словам двух участников совещания, это мнение также разделяет представитель
Сибирского научно-исследовательского института авиации (СибНИА). В 2013 году
Минпромторг [https://nrczh.ru/press-center/news/k-75-letiyu-so-dnya-pervogo-
poleta-an-2/] назначил этот институт разработчиком самолетов Ан-2 на территории
России.

В пресс-службе Минпромторга заявили, что министерство совместно с
производителями провело научно-исследовательские и опытно-конструкторские
работы, учитывая важность для России сохранения перевозок на местных воздушных
линиях. Они были нацелены на разработку базовых технологий и на создание
авиатехники, способной прийти на замену Ан-2. В результате сейчас Уральский
завод гражданской авиации занимается созданием легкого многоцелевого самолета
«Байкал», отметил представитель Минпромторга.

РБК направил запросы в пресс-службы Росавиации и СибНИА.

Что известно о самолете Ан-2

Ан-2 рассчитан на перевозку 12 пассажиров, дальность полета с полной загрузкой
составляет около 800 км. Серийное производство этого самолета началось в СССР в
1949 году. В конце 1950-х годов Ан-2 стали производить и в Польше, а с середины
1970-х в этой стране начали изготавливать и моторы для него.

По данным СибНИА на 2022 год, общее количество Ан-2 в России сократилось по
сравнению с 2015 годом на 32,5% и составило 1012 самолетов. За тот же период
число самолетов Ан-2 с сертификатами летной годности (имеют право летать)
снизилось на 14,5%, до 218 машин.

Почему возникли проблемы с Ан-2

По словам Ненастьева, главный риск сокращения парка самолетов Ан-2 связан с
поставкой комплектующих и запчастей для ремонта моторов. Международные санкции
запрещают поставку российским компаниям авиационных изделий и запчастей из
западных стран.

Шахтинский завод продолжает оказывать услуги по ремонту Ан-2 благодаря
небольшому запасу комплектующих, отмечает Соломатов. Но он считает, что, если не
решить проблему с поставками запчастей, «через полгода машины начнут вставать».
Процесс остановки парка Ан-2 может быть «достаточно скоротечным», флот этих
самолетов будет сокращаться быстрее, чем операторы будут получать воздушные суда
им на замену, к примеру машины «Байкал», соглашается Ненастьев.

Давно пора заняться этой проблемой, говорит глава Шахтинского завода. Необходимо
организовать производство комплектующих в России, добавляет гендиректор компании
«Авиацентр-411» (занимается ремонтом Ан-2 в Минводах) Вячеслав Казин. «Мы бьемся
за это пятый год, пытаемся разместить на любом мало-мальски значительном заводе
заказ на комплектующие, которые легко выпускать, но нужны огромные объемы заказа
и государственная поддержка», поясняет он. При этом у «Авиацентра-411»
сформирован достаточный запас деталей и агрегатов, утверждает Казин: «В нашем
распоряжении ремонтный фонд на 50 самолетов и двигателей».

[https://www.rbc.ru/business/17/03/2023/6412e2879a7947737ee2be3e?from=article_bo
dy] Компании увидели риски для SSJ из-за дефицита свечей зажигания

[https://www.rbc.ru/business/] Бизнес
[https://www.rbc.ru/business/17/03/2023/6412e2879a7947737ee2be3e?]

Если раньше на авиаремонтных заводах в ходе сервиса Ан-2 использовались
абсолютно новые компоненты, то сейчас в ход идет большая доля комплектующих, уже
бывших в употреблении, отмечает замдиректора авиакомпании «Аэропром» Мария
Давыденко. Качество ремонта «заметно ухудшилось», подтверждает гендиректор
авиакомпаний «Лайт Эйр» и «Русавиа» Дмитрий Торопов. «Если год назад досрочная
замена мотора требовалась один раз на десять самолетов, то сейчас иногда доходит
до трех случаев», — указывает он.

При этом государственные предприятия по законодательству не могут приобретать
комплектующие и запчасти, бывшие в употреблении, восстановленные или с
продленным ресурсом работы, замечает Валерий Новиков, начальник инженерно-
авиационной службы лесопожарного центра «Север» (филиал ФБУ «Авиалесоохрана»)
Валерий Новиков. По его словам, такая ситуация осложняет поддержание летной
годности Ан-2. К тому же сроки поставки запчастей сильно выросли, а ремонт
подорожал, добавляет Торопов. По его данным, до пандемии коронавируса
капитальный ремонт Ан-2 стоил до 3 млн руб., двигателя — около 600 тыс. Сейчас
цены выросли до 5–7 млн руб. и минимум 2 млн руб. соответственно.

С какими еще сложностями столкнулись операторы Ан-2

Несмотря на прекращение производства Ан-2 (в СССР выпускался до 1971 года, в
Польше — до 2002 года), эти самолеты в России, кроме выполнения авиаработ,
продолжают перевозить пассажиров. По данным Росавиации на середину июня 2023
года, к коммерческим перевозкам [https://favt.gov.ru/dejatelnost-aviakompanii-
reestr-komercheskie-perevozki/] были допущены 40 Ан-2 у десяти авиакомпаний.

В пресс-службе 2-ого Архангельского объединенного авиаотряда (крупнейшего
оператора Ан-2 на пассажирских линиях) сообщили, что, помимо сложностей с
поставками запчастей, на эксплуатации этих воздушных судов отразилось повышение
стоимости горюче-смазочных материалов. Так, уход из России в 2022 году компании
Shell, поставлявшей масла для поршневых двигателей Aeroshell W100 (W120), привел
к значительному удорожанию авиационного масла на рынке, на 100–120%, в течение
нескольких месяцев.

[https://www.rbc.ru/business/25/03/2022/623addd59a7947341ce3f2e7?from=article_bo
dy] Авиакомпании предупредили о риске остановки полетов на Ан-24 и Ан-26

[https://www.rbc.ru/business/] Бизнес
[https://www.rbc.ru/business/25/03/2022/623addd59a7947341ce3f2e7?]

Также есть проблемы с радиостанциями, стойками шасси и лыжами (используются для
посадки на снег), добавляет гендиректор Нарьян-Марского объединенного авиаотряда
Яков Меньшаков. Кроме того, у Ан-2 возникает больше новых дефектов, связанных с
«усталостью материалов», говорит представил авиакомпании «Мобил Авиа».

Сколько можно будет летать на таких самолетах

При условии создания в России производства по выпуску запчастей и комплектующих
самолеты Ан-2 возможно эксплуатировать «без особых проблем» в ближайшие 10–15
лет, считает Новиков. Если государство собирается поддерживать эксплуатацию
судов в течении этого срока, то, скорее всего, необходимо возобновить выпуск
деталей цилиндрово-поршневой группы в полном объеме, маслонасосов двигателя,
топливоподкачивающих насосов и других запчастей, перечисляет директор
авиационного предприятия «Вираж» Константин Малиевский. Минпромторг оказывает
поддержку российским предприятиям, осваивающим выпуск высокотехнологичной
продукции, в том числе в рамках проектов импортозамещения, сказал РБК
представитель ведомства.

[https://www.rbc.ru/business/26/07/2021/60fe87ee9a79472cbc088689?from=article_bo
dy] Власти потратят ₽36 млрд на замену кукурузников

[https://www.rbc.ru/business/] Бизнес
[https://www.rbc.ru/business/26/07/2021/60fe87ee9a79472cbc088689?]

На замену Ан-2 Нарьян-Марский авиаотряд ждет самолет «Байкал», но для него еще
нет российского двигателя, говорит Меньшаков. До конца 2023 года будет получен
сертификат типа на самолет с импортным мотором H80-100, до конца 2025 года — с
российским двигателем ВК-800СМ, сообщила официальный представитель УЗГА Алена
Ачкасова. По ее словам, авиакомпании уже подписали обязывающие соглашения о
поставках примерно 60 «Байкалов». Первые самолеты они смогут получить в 2024
году, добавляет представитель Минпромторга. УЗГА будет поставлять перевозчикам
не менее 25 таких судов ежегодно, что позволит в сжатые сроки заменить Ан-2 на
регулярных пассажирских перевозках.

Однако в понедельник, 3 июля, вице-премьер-полномочный представитель президента
в Дальневосточном федеральном округе Юрий Трутнев в ходе совещания по работе
авиакомпании «Аврора» [http://www.dfo.gov.ru/trutnev/6507/] поручил разобраться
с ростом цен на «Байкал»: «Нам надо строить самолеты так, чтобы цена их
эксплуатации была разумной, чтобы стоимость перевозок тоже была для людей
посильной и нормальной». В 2021 году цена «Байкала» в девятиместной базовой
версии [https://www.rbc.ru/business/26/07/2021/60fe87ee9a79472cbc088689]
составляла 120 млн руб. В ценах 2023 года самолет стоит «ненамного дороже» — 151
млн руб., утверждает Ачкасова. При этом стоимость Ан-2 в зависимости от остатка
межремонтного ресурса варьируется от 3 до 15 млн руб., замечает президент
«Вяткаавиа» Олег Кочкин.

Предельная цена самолета «Байкал» при серийном производстве и стоимость летного
часа (без учета стоимости владения) при регулярной эксплуатации установлены в
техническом задании на выполнение опытно-конструкторской работы и подлежат
индексации по годам с сохранением соответствующих предельных значений,
подчеркивает пресс-служба Минпромторга. Там добавили, что будут проведены
соответствующие расчеты для подтверждения или, при необходимости, корректировки
полученных параметров.

В ближайшие пять лет «Байкал» не станет реальной заменой Ан-2 из-за их
несопоставимой стоимости, кроме того, он менее вместителен, полагает Новиков.
Вывод на рынок таких самолетов отчасти снимет проблемы Ан-2, считает главный
эксперт центра экономики транспорта ВШЭ Федор Борисов. «Но «Байкал» для северных
регионов будет наверняка перевозить не девять, а семь пассажиров, так как нужно
больше пространства в салоне для перевозки грузов и багажа», — замечает он. По
словам исполнительного директора агентства «АвиаПорт» Олега Пантелеева, «Байкал»
станет полноценной заменой Ан-2, по мере того как разработчик будет создавать
разные модификации.
```

https://www.gazeta.ru/business/2023/07/04/17232992.shtml
```markdown
# Экономист объяснил, почему нельзя дать прогноз по курсу рубля на осень

# Финансовый аналитик Беляев предположил, что рубль будет падать еще два-три дня

Максим Богодвид/РИА «Новости»

Во вторник, 4 июля, курс доллара на Мосбирже впервые с 28 марта 2022 года был
выше 90 рублей, а курс европейской валюты поднимался до 98 рублей. Финансовый
аналитик, кандидат экономических наук Михаил Беляев в комментарии «Газете.Ru»
объяснил, что нынешний курс определяется информационным фоном и ажиотажным
спросом. По его мнению, ситуация начнет выправляться, когда бизнесмены выйдут из
летаргического сна — и начнут действовать.

Cпрогнозировать это все очень сложно — рост курса доллара по отношению к рублю
уже вырвался за экономические границы, за экономические факторы. Он определяется
не очень спокойным информационным фоном. Поэтому наши инвесторы и держатели
рублей пытаются уйти в традиционный для себя защитный актив — иностранную
валюту.

Это относится и к доллару, и к евро — объяснение одно и то же. Вместе с тем, у
нас не самое прочное положение экономики. Оно не определяет падение рубля по
отношению к доллару на такие величины. Оно может определять неустойчивость, но
не определять такое падение. Дальше уже включаются психологические факторы этих
самых инвесторов, которые мы видим.

На прошлой неделе было достаточно резкое, стремительное падение рубля по
отношению к доллару. Сейчас оно продолжилось, причем тревожность заключается в
том, что падение не было остановлено даже прекращением торгов в выходные дни.
Как правило, если есть такой информационный фон неблагоприятный и повышенный
спрос, то или возникает такая пауза в торгах календарная, или специально
биржевые торги прекращают для того, чтобы биржа успокоилась. И все это
возвращается на прежние позиции.

Мы видим, что курс рубля по отношению к доллару определяется повышенным,
ажиотажным спросом, ажиотажными факторами. Не исключено, что они могут
продолжиться и завтра, и послезавтра.

Тогда придется приостанавливать биржевые торги, давать бирже паузу для того,
чтобы доллар откатился — на отметке в 95 рублей он может остановиться. Поэтому
четкий прогноз дать нельзя, потому что нет экономических точек опоры, на которые
можно было бы опереться и сказать, что произойдет.

Я думаю, что падение рубля по отношению к доллару продолжится в течение еще
двух-трех дней. Насколько оно будет интенсивным, сказать трудно. Дальше два
варианта:

1) Будет остановлена биржа. По правилам биржевых торгов, когда сильное падение,
останавливается просто операция, дается передышка и происходят восстановительные
процессы.

2) Или действительно доллар достигнет своей вершины, поскольку информационный
фон не может продолжаться вечно, он когда-то натыкается на свои пределы, и
начнется коррекция.

Я думаю, еще дня 2-3 мы увидим ослабление рубля по отношению к доллару, а потом
по одному из этих двух сценариев произойдут определенные действия, и рубль
откатится по отношению к доллару. По евро то же самое.

На осень при таких условиях давать прогноз очень трудно, потому что у нас
информационный фон изобилует непредсказуемыми событиями не самого позитивного
характера.

Но глубинных, серьезных экономических факторов нет — кроме того, что у нас
экономика все никак не может выйти из состояния развития около нуля, застоя.
Пусть это и деятельная пауза, как ее называют, но все равно это пауза, в то
время как американская экономика показывает более динамичные характеристики.
Хотя там тоже есть свои проблемы, но динамика, если сравнивать с российской
экономикой, более позитивная, это и определяет укрепление доллара по отношению к
рублю. Давать прогноз в тот момент, когда превалируют и определяют рисунок курса
именно ажиотажные факторы — самое неблагоприятное действие.

Если удастся наших бизнесменов вывести из состояния летаргического сна, и они
наконец начнут действовать динамично, тогда ситуация будет выправляться. Но это
зависит от этого «если». Прогноз без него дать невозможно. Они долго находятся в
состоянии застоя и ждут, когда что-нибудь или кто-нибудь им поможет и как-то их
поддержит. Вместо того, чтобы действовать самим и преодолевать сложности,
которые перед ними возникают.

На то они и предприниматели, чтобы их не с чайной ложечки кормили, как они
привыкли, а действовать так, как должны действовать бизнесмены.

Плохо всей экономике в целом, потому что на падении курса рубля по отношению к
доллару выигрывают экспортеры. Они получают больше рублей в пересчете на
вырученную единицу валюты. Продается нефть, допустим, за доллары — они получают
доллары, или евро, или юани, пересчитывают в рубли. Поскольку рубль более
дешевый, на единицу зарубежной валюты можно купить больше этих самых рублей. А
внутри страны у нас действуют рубли, значит, тут экспортеры чувствуют себя
свободнее.

Но ровно столько же проигрывают импортеры, то есть те, кто ввозит определенные
товары в страну. Причем проигрывают и те, кто ввозят товары потребительского
рынка (это непосредственно отражается на инфляционном росте цен), и проигрывают
промышленные предприятия, которым надо развиваться, надо ввозить станки, ввозить
оборудование.

Оно становится более дорогим, более трудным к ввозу — эти цены перекладываются
на готовую продукцию, что вносит дополнительный вклад в рост цен, то есть в
инфляцию.

То есть у нас выигрывают экспортеры, о чем мы очень любим говорить, но столько
же проигрывают импортеры, о чем мы не любим говорить. Поэтому радоваться
ослаблению рубля не стоит.

А вслед за повышением инфляционных тенденций тут как тут будет Центробанк,
который повысит ключевую ставку — а он ее точно повысит, ссылаясь на
инфляционное давление — а это окажет сдерживающее воздействие на развитие
экономики. Так что выиграв что-то от экспорта, мы намного больше проиграем по
импорту и намного больше проиграем по возможности выведения наших
предприниматели из летаргического сна.

[https://t.me/+sqMTCoFLtAc5MzAy]
```

https://lenta.ru/news/2023/07/05/iphone15/
```markdown
[/2023/07/05/] 09:02, 5 июля 2023

# Новые iPhone получат увеличенную батарею

[https://icdn.lenta.ru/images/2023/07/04/16/20230704160641866/wide_4_3_430e4077e
e8c8d8ad892e40335773589.jpg]

Фото: Kim Kyung-Hoon / Reuters

[/tags/organizations/apple/] Компания Apple запланировала заметно увеличить срок
автономной работы своих смартфонов. Об этом
[https://www.ithome.com/0/703/705.htm] сообщает китайское издание ITHome.

Журналисты медиа сослались на отчет инсайдера, якобы связанного с Foxconn —
основным производителем смартфонов Apple в [/tags/geo/kitay/] Китае . По
информации автора, все устройства серии iPhone 15 получат увеличенные
аккумуляторы — батареи станут больше примерно на 350-600 миллиампер-часов по
сравнению с устройствами 2022 года выпуска.

Так, батарея самого доступного девайса новой серии — iPhone 15 — увеличится с
3279 до 3877 миллиампер-часов, iPhone 15 Plus — с 4325 до 4912 миллиампер-часов.
Батареи увеличенной емкости получат и премиальные модели. Инсайдер сообщил, что
аккумулятор iPhone 15 Pro увеличится с 3200 до 3650 миллиампер-часов, iPhone 15
Pro Max — с 4323 до 4852 миллиампер-часов.

Журналисты издания заметили, что Apple почти каждый год делает акцент на том,
что их новые смартфоны получают улучшенные батареи. Однако авторы подчеркнули,
что разница между аккумуляторами аппаратов серий iPhone 14 и iPhone 13 оказалась
не очень большой.

Ранее инсайдеры [https://lenta.ru/news/2023/05/25/nolimits/] рассказали , что
компания Apple решила не ограничивать скорость беспроводной зарядки своих новых
смартфонов. Так, авторы выяснили, что аппараты iPhone 15 будут заряжаться с
одинаковой скоростью — как при использовании оригинальной, так и сторонней
зарядки.
```

# Направление дальнейшего улучшения/развития программы

* Улучшить обработку ошибок. Сейчас во многих местах не хватает обработки ошибок и вывода соответствующих сообщений.
Например, при загрузке страницы, при некорректном описании правил, при ошибке сохранения результатов.
* Добавить в выражениях правил использовать путь до узла, а не только имя тега и атрибуты.
* Добавить возможность заглядывать вперед при обходе. Это позволит лучше отформатировать вывод ссылок 
(текст ссылки можно будет вывести до адреса, что выглядит логичнее).
* Добавить правила с регулярными выражениями.
* Можно улучшить обработку не xhtml. Сейчас с этим могут быть проблемы, если теги будут не закрыты (или не открыты).
Возможно стоит заиспользовать нестандартную библиотеку html-парсера.
* Добавить пакетный режим, для обработки сразу нескольких адресов.
* Добавить опции для управления форматирование вывода (максимальная длинна строки, форматирование ссылок и заголовков и т.д.)
* Добавить возможность объединять пользовательские правила с правилами по умолчанию. Сейчас пользовательские правила
полностью замещают правила по умолчанию.
